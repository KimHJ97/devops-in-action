# 처음 만나는 쿠버네티스

## 쿠버네티스

쿠버네티스(Kubernetes)는 컨테이너화된 애플리케이션을 자동으로 배포, 확장 및 관리하기 위한 오픈소스 플랫폼입니다. Google에서 개발한 오픈소스 프로젝트로 시작되었으며, 현재는 Cloud Native Computing Foundation (CNCF)의 관리 아래에서 개발되고 있습니다.  

쿠버네티스는 컨테이너 오케스트레이션(orchestration) 도구로서, 여러 대의 호스트에 걸쳐 컨테이너화된 애플리케이션을 자동으로 배포하고 관리하는 데 사용됩니다. 쿠버네티스는 애플리케이션을 실행하기 위한 컨테이너의 배치와 스케일링, 그리고 네트워킹, 스토리지, 서비스 디스커버리 등 다양한 기능을 제공하여 애플리케이션을 보다 효율적으로 관리하고 확장할 수 있도록 지원합니다.  

 - __자동화된 빈 패킹(bin packing)__: 컨테이너화된 작업을 실행하는데 사용할 수 있는 쿠버네티스 클러스터 노드를 제공한다. 각 컨테이너가 필요로 하는 CPU와 메모리(RAM)를 쿠버네티스에게 지시한다. 쿠버네티스는 컨테이너를 노드에 맞추어서 리소스를 가장 잘 사용할 수 있도록 해준다.
 - __자동화된 복구(self-healing)__: 쿠버네티스는 실패한 컨테이너를 다시 시작하고, 컨테이너를 교체하며, '사용자 정의 상태 검사'에 응답하지 않는 컨테이너를 죽이고, 서비스 준비가 끝날 때까지 그러한 과정을 클라이언트에 보여주지 않는다.
 - __자동화된 롤아웃과 롤백__: 쿠버네티스를 사용하여 배포된 컨테이너의 원하는 상태를 서술할 수 있으며 현재 상태를 원하는 상태로 설정한 속도에 따라 변경할 수 있다. 예를 들어 쿠버네티스를 자동화해서 배포용 새 컨테이너를 만들고, 기존 컨테이너를 제거하고, 모든 리소스를 새 컨테이너에 적용할 수 있다.

<br/>

### Borg와 Omega

Borg와 Omega는 Google에서 쿠버네티스의 선구자가 되는 중요한 내부 시스템입니다. 이들은 쿠버네티스가 개발되는 데 영감을 주고 기술적인 기반을 제공한 시스템입니다.  

__Borg__ 는 Google 내부에서 개발된 대규모 클러스터 관리 시스템으로, 컨테이너 오케스트레이션의 선구자입니다. Borg는 2003년에 Google에서 개발되었으며, Google의 대규모 서비스 및 작업을 효율적으로 관리하기 위해 사용되었습니다. Borg는 컨테이너화된 작업의 스케줄링, 자원 관리, 모니터링 등을 담당하여 Google의 인프라를 효율적으로 운영할 수 있도록 지원했습니다.  
 - Google에서 개발한 최초의 통합 컨테이너 관리 시스템
 - 자원 요구사항 예측하여 리소스 활용도를 높이고 비용을 줄이는 방법을 제공
 - Configuration 파일을 실행 중인 서비스에 동적으로 반영
 - 서비스 디스커버리, 로드밸런싱, 자동 크기 조정 등

<br/>

__Omega__ 는 Borg의 후속 버전으로 개발된 내부 시스템입니다. Borg에서 발전한 기술과 아이디어를 기반으로 하며, Borg의 제약사항을 극복하고 확장성을 향상시키는 데 중점을 두었습니다. Omega는 Borg보다 더 유연하고 확장 가능한 아키텍처를 제공하여 Google의 서비스를 효율적으로 실행할 수 있도록 도왔습니다.  
 - 클러스터 상태의 일관성을 부여하기 위해 클러스터 상태를 저장 기능을 추가(영구 저장소)
 - 낙관적 동시성 제어 방법을 이용해서 리소스 충돌을 해결한다.

<br/>

__Kubernetes__ 는 Borg, Omega와 달리 오픈소스 구글 퍼블릭 클라우드 인프라 사업을 성장시키기 위해 설계하고 개발하여 Omega처럼 리소스 변경 사항을 저장하기 위한 공유 영구 저장소가 있지만, Omeaga는 이 저장소를 신뢰할 수 있는 구성요소들이 직접 접근할 수 있도록 개방한 것과 달리, 쿠버네티스는 더 높은 수준의 추상화를 위해 REST API를 통해서만 접근할 수 있도록 바꾸었다. 더 중요한 것은 쿠버네티스가 클러스터에서 실행되는 애플리케이션을 개발하는 개발자의 경험에 더 중점을 두고 개발했다는 점이다. 주요 설계 목표는 __컨테이너로 향상된 리소스 활용의 이점을 누리면서도 복잡한 분산 시스템을 쉽게 배포하고 관리할 수 있게 만드는 것__ 이었다.  

<br/>

### 쿠버네티스의 의미

쿠버네티스는 조타수를 의미하며, 조타수는 주어진 명령을 핸들에 반복 실행해야 한다. 즉, 애플리케이션을 컨테이너로 배포하고 정상적으로 실행될 수 있도록 책임을 진다.  
쿠버네티스는 여러 개의 컨테이너화된 애플리케이션을 여러 서버(쿠버네티스 클러스터)에 자동으로 배포, 스케일링 및 관리해주는 오픈소스 시스템이다.  
 - 클러스터: 여러 개의 서버를 하나로 묶은 집합, 하나의 서버처럼 동작
 - 쿠버네티스 클러스터: 애플리케이션 컨테이너를 배포하기 위한 서버 집합

<br/>

## 쿠버네티스 오브젝트


쿠버네티스 오브젝트는 쿠버네티스 시스템에서 관리되는 핵심 구성 요소입니다. 이러한 오브젝트들은 쿠버네티스 클러스터의 상태와 구성을 정의하고 제어하는 데 사용됩니다. 쿠버네티스에서 애플리케이션을 배포하고 관리하기 위해 오브젝트를 정의하고 이를 클러스터에 적용할 수 있습니다.  

일반적으로 쿠버네티스 오브젝트는 YAML 또는 JSON 형식으로 정의됩니다. 이러한 오브젝트들은 API 객체로서 쿠버네티스 API 서버에 제출되어 클러스터 상태를 변경하거나 관리 작업을 수행합니다.  

 - __Pod__: 쿠버네티스에서 가장 기본적인 배포 단위로서, 하나 이상의 컨테이너 그룹을 포함합니다.
 - __Service__: 여러 개의 파드에 대한 로드 밸런싱과 네트워크 서비스를 제공합니다.
 - __Deployment__: 파드를 관리하고 업데이트하기 위한 추상화를 제공합니다.
 - __Namespace__: 리소스를 그룹화하고 격리하기 위한 가상 클러스터를 제공합니다.
 - __ConfigMap__: 설정 데이터를 파드에 주입하기 위한 방법을 제공합니다.
 - __Secret__: 암호화된 데이터를 포함하는 파드의 설정을 관리합니다.
 - __PersistentVolumeClaim (PVC)__: 영구적인 스토리지를 요청하고 이에 대한 접근을 제공합니다.
 - __ServiceAccount__: 파드와 같은 애플리케이션에 대한 권한을 관리합니다.
 - __StatefulSet__: 상태가 있는 애플리케이션을 배포하고 관리하기 위한 추상화를 제공합니다.

어떤 애플리케이션을(Pod), 얼마나(ReplicaSet), 어디에(Node, Namespace), 어떤 방식으로 배포할 것인가(Deployment), 트래픽을 어떻게 로드밸런싱 할 것인가(Service, Endpoints)로 나눌 수 있다.  

 - `예제`
    - apiVersion: 오브젝트를 생성할 때 사용하는 API 버전
    - kind: 생성하고자 하는 오브젝트 종류
    - metadata: 오브젝트를 구분 지을 수 있는 정보
    - spec: 사용자가 원하는 오브젝트 상태
```yml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  selector:
    matchLabels:
      app: nginx
  replicas: 2
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
```