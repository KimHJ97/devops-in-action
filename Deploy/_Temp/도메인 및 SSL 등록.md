# 도메인 및 SSL 등록

## AWS 환경

 - Route 53 도메인 발급
 - ACM 인증서 발급
    - 이떄, '*.도메인', '도메인' 으로 도메인 등록
    - 인증서 발급 후 도메인 변경이 불가능
 - 배포할 EC2 생성
 - 로드밸런서 타겟 그룹 생성
 - 로드밸런서 ALB 생성
 - Route 53 도메인에 로드 밸런서 연결
    - 도메인 요청시 -> 로드 밸런서로 전달
 - 로드 밸런서에 리스너 및 라우팅 변경
    - 80 요청시 -> 443 리다이렉션
    - 443 요청시 -> EC2 서버 포트로 전달

### AWS - Route 53

AWS에서 Route 53은 DNS 웹 서비스로 도메인 등록과 트래픽 관리 같은 다양한 기능을 제공한다.  

 - 도메인 이름 관리 (DNS 서비스)
    - 도메인 이름을 IP 주소로 변환
    - DNS 레코드(A, CNAME, MX 등)를 설정해 도메인의 트래픽을 원하는 곳으로 라우팅
 - 도메인 등록
    - 도메인 구매/관리
 - 트래픽 라우팅
    - 단순 라우팅: 하나의 IP 주소나 도메인으로 트래픽 전송
    - 가중치 라우팅: 여러 리소스에 트래픽을 비율에 따라 나누어 전송
    - 지연 시간 기반 라우팅: 사용자의 지리적 위치에 따라 가장 짧은 응답 시간을 제공하는 리소스로 트래픽 전송
    - 장애 조치 라우팅: 주 리소스가 장애가 발생하면 백업 리소스로 트래픽 전환
    - 지리적 라우팅: 사용자의 위치에 따라 다른 리소스로 트래픽 전송
 - 건강 상태 확인
    - DNS 라우팅 대상이 되는 서버나 리소스의 상태를 모니터링
 - AWS와 통합
    - 다른 AWS 서비스와 통합하여 쉽게 클라우드 리소스와 연결할 수 있음
    - EC2, S3 버킷, Lastic Load Balancer와 같은 AWS 서비스에 도메인 이름을 연결
```
1. Route 53 대시보드로 이동
2. 도메인 > 등록된 도메인 화면 이동
3. 도메인 등록 클릭
 - 승인까지 다소 시간이 걸릴 수 있음 (10분 이상)


★ 로드밸런서 생성 이후 작업
1. Route 53 대시보드로 이동
2. 호스팅 영역 > 도메인 클릭 > 레코드 등록
 - 레코드 이름
 - 레코드 유형: A (IPv4)
 - 별칭으로 선택
    - Application/Classic Load Balancer에 대한 별칭
    - 아시아 태평양 서울
    - alb 선택
    - 라우팅 정책: 단순 라우팅

★ 호스팅 영역 주의 사항
 - 'www.도메인', '도메인'에 대해서 A 레코드로 ALB 트래픽 라우팅
 - ACM에서 Route 53에 레코드 추가로 인증서의 CNAME을 쉽게 등록 가능
    - 직접 ACM의 CNAME을 복사해서 Route 53 호스팅 영역에 추가할 수도 있음
 - ※ 호스팅 영역 생성시 NS 값을 등록된 도메인에 업데이트 해주어야 함
```

### AWS - Certificate Manager(ACM)

AWS에서 ACM은 SSL/TLS 인증서를 손쉽게 생성하고 관리할 수 있는 서비스로 웹 애플리케이션에서 사용되는 트래픽을 암호화하여 보안을 강화할 수 있으며, 복잡한 인증서 발급, 갱신, 관리 과정을 자동화할 수 있다.  

 - SSL/TLS 인증서 발급
    - 도메인 인증서(SSL/TLS)를 쉽게 발급 가능
    - ACM은 무료로 인증서를 제공하며, 유용한 AWS 리소스에 배포할 수 있음
 - 인증서 자동 갱신
    - ACM을 통해 발급된 인증서는 만료 전에 자동으로 갱신
 - 도메인 인증
    - 인증서를 발급하기 위해서는 도메인 소유권을 증명해야 한다.
    - ACM은 도메인 검증 방식을 사용하여 도메인의 소유권을 확인
 - AWS 서비스와 통합
    - ACM에서 발급받은 인증서는 AWS 서비스와 쉽게 통합
    - ELB: HTTPS를 통해 애플리케이션의 트래픽을 암호화하여 보안성 강화
    - CloudFront: 글로벌 콘텐츠 전송 네트워크에서 배포된 웹 애플리케이션에 SSL/TLS 인증서 적용
    - API Gateway: API 트래픽을 암호화하고 보안을 강화

```
1. Certificate Manager 대시보드로 이동
2. 인증서 요청
 - 퍼블릭 인증서 요청
 - 도메인 이름
    = '도메인'
    - '*.도메인' 으로 모든 요청 처리 가능
    - 'www.도메인' 으로 www로 들어오는 요청 처리 가능
 - 검증 방법: DNS 검증
 - 키 알고리즘: RSA 2048
```

### AWS - Elastic Load Balancer(ELB)

AWS에서 ELB는 자동 부하 분산 서비스로 여러 애플리케이션 서버로 들어오는 트래픽을 자동으로 분산하여 애플리케이션의 가용성, 확장성, 복원력을 높이는 데 사용된다.  

 - __Application Load Balancer (ALB)__
    - 애플리케이션 계층(HTTP/HTTPS)에서 동작하며, L7 계층에서 동작
    - URL 경로, 호스트 헤더, HTTP 메서드, 쿼리 문자열, 요청 내용 등에 기반한 정교한 라우팅이 가능하여, 애플리케이션에 따라 트래픽을 세밀하게 분배할 수 있다.
    - 마이크로서비스 아키텍처나 컨테이너 기반 애플리케이션에 적합하며, 여러 서비스로 트래픽을 분산시킬 때 유용하다.
    - ALB는 HTTP/HTTPS 트래픽을 처리하고, 웹 소켓과 TLS 종료를 지원
 - __Network Load Balancer (NLB)__
    - 네트워크 계층(TCP/UDP)에서 동작하며, L4 계층에서 동작
    - 매우 높은 성능을 요구하는 애플리케이션에 적합하며, 초당 수백만 개의 요청을 처리할 수 있다.
    - 트래픽이 특정 IP 주소와 포트로 매우 빠르게 라우팅되며, 저지연과 고성능을 제공하는 서비스에 유리하다.
    - TCP, UDP 및 TLS 트래픽을 처리하며, 내부와 외부 모두에서 사용할 수 있다.
 - __Gateway Load Balancer (GWLB)__
    - 가상 네트워크 어플라이언스와 함께 사용되며, L3/L4 계층에서 동작
    - 네트워크 트래픽을 투명하게 전달하면서 보안 장치나 모니터링 장치와 같은 가상 어플라이언스를 적용할 수 있다.
    - 네트워크 트래픽의 흐름을 변경하지 않고도 방어나 모니터링 서비스로 트래픽을 보낼 수 있다.
 - __Classic Load Balancer (CLB)__
    - 전통적인 방식의 L4/L7 로드 밸런싱
```
1. EC2 대시보드로 이동
2. 로드 밸런싱 > 대상 그룹 화면 이동 > 대상 그룹 생성
 - 로드 밸런싱을 만들기전에 대상 그룹이 먼저 만들어져야 한다.
 - 기본 구성
    - 대상 유형 선택: 인스턴스
    - 대상 그룹 이름: ex) prd-ecommerce-api-tg-80
    - IP 주소 유형: IPv4
 - 상태 검사
    - 프로토콜: HTTP
    - 상태 검사 경로: "/"
 - 태그
    - Name: 대상 그룹 이름과 동일하게 설정
 - 대상 등록
    - 인스턴스 선택


3. 로드 밸런싱 > 로드밸런서 화면 이동 > 로드밸런서 생성
Application Load Balancere 생성 클릭
 - 기본 구성
    - 로드 밸런서 이름: 
        - 환경명 - 업무명 - 서비스명 - 리소스명
        - ex) 운영 환경(prd-ecommerce-api-alb)
    - 체계: 인터넷 경계
    - 로드 밸런서 IP 주소 유형: IPv4
 - 네트워크 매핑
    - VPC: EC2와 동일한 VPC
    - 매핑: ap-northeast-2a, ap-northeast-2c
        - EC2의 서브넷 확인 > 가용 영역 확인
 - 보안 그룹: ec) 운영 환경(prd-ecommerce-api-alb-sg)
    - 보안 그룹 생성
        - 인바운드
            - 사용자 지정 TCP 80
            - 사용자 지정 TCP 443
 - 리스너 및 라우팅
   - 리스너 및 라우팅 등록하기 위해서는 대상 그룹을 생성해야 한다.
   - HTTP: 80
        - URL로 리디렉션 -> HTTPS 443
   - HTTPS: 443
        - 대상 그룹으로 전달 -> 타겟 그룹 8080
 - 보안 리스너 설정
    - 기본 SSL/TLS 서버 인증서
        - ACM -> 인증서 선택
 - 로드 밸런서 태그
    - Name: 로드밸런서 이름과 동일하게 설정
```

