# 계정 생성 및 IAM

## 계정 생성

AWS 계정을 생성하기 위해서는 본인 명의의 신용카드가 필요하다.  
AWS 계쩡을 처음 생성하면 루트 유저와 기본 리소스(기본 VPC) 등이 생성된다.  
또한, AWS 계정을 생성하면 숫자로된 아이디가 부여되는데 별명을 지정하여 사용하는 것이 편리하다.  

 - 루트 유저
    - 생성한 계정의 모든 권한을 자동으로 가지고 있음
    - 생성시 만든 이메일 주소로 로그인
    - 탈취당했을 때 복구가 힘들기 때문에 사용을 자제하고 MFA 설정이 필요하다.
    - 루트 유저는 관리용으로만 이용한다. (계정 설정, 빌링 등)
    - AWS API 호출 불가(AccessKey/Secret AccessKey 부여 불가)
 -  IAM 유저
    - IAM 유저는 Identity and Access Managerment를 통해 생성한 유저를 말한다.  
    - 기본적으로 권한이 없으며, 따로 권한을 부여해야 한다.  
    - 또한, IAM 유저는 사람이 아니라 애플리케이션에서 사용되는 가상의 주체가 될 수 있다.  
    - AWS API 호출 가능 ((AccessKey/Secret AccessKey)
    - 권한 부여시 루트 유저와 같이 모든 권한을 가질 수 있지만 빌링 관련 권한은 루트 유저가 따로 허용해주어야 한다.
```
★ 루트 유저와 IAM 유저 만들기
1. AWS 계정 만들기

2. 루트 유저로 로그인

3. 루트 유저 MFA 설정
 - 계정 클릭 > 내 보안 자격 증명 > 멀티 팩터 인증(MFA) > 가상 MFA 디바이스(모바일) > QR 코드 이미지를 저장해두어야 한다.
 - 구글 OTP

4. 계정 별명 생성
 - IAM 대시보드 > AWS 계정 별칭 생성 > 별칭은 중복이 불가능하다.(고유)

5. 관리 권한(Admin Access)을 가진 IAM 유저 생성
 - IAM 대시보드 > 사용자 > 사용자 추가
    - 액세스 유형: API나 CLI 등으로 접근시 프로그래밍 방식 액세스 체크, AWS Console 웹페이지에서 접근시 AWS Console 액세스 체크
    - 권한 설정: AdministratorAccess (AWS의 모든 권한을 부여한다. 다만, 빌링을 루트 유저에서 따로 설정해주어야 한다.)

6. IAM 유저 MFA 설정
 - IAM 대시보드 > 사용자 > 생성한 사용자 클릭(상세)
    - 보안 자격 증명 > 할당된 MFA 디바이스 관리 > 가상 MFA 디바이스(모바일)

7. 루트 유저로 로그아웃하고 IAM 유저로 로그인

★ 
1. 루트 유저로 로그인

2. 
 - 계정 클릭 > 내 계정 > 결제 정보에 대한 IAM 사용자 및 역할 액세스 편집 > 활성화
```

<br/>

## IAM

AWS Identity and Access Management(IAM)를 사용하면 AWS 서비스와 리소스에 대한 액세스를 안전하게 관리할 수 있다. 또한, AWS 사용자 및 그룹을 만들고 관리하며 AWS 리소스에 대한 액세스를 허용 및 거부할 수 있다.  

 - AWS 어카운트 관리 및 리소스/사용자/서비스의 권한 제어
    - 서비스 사용을 위한 인증 정보 부여
 - 사용자의 생성 및 관리 및 계정의 보안
    - 사용자의 패스워드 정책 관리
 - 다른 계정과의 리소스 공유
    - Identity Federation(Facebook 로그인, 구글 로그인 등)
 - IAM은 글로벌 서비스 (리전별 서비스가 아님)

<br/>

### IAM 구성

 - 사용자
   - 실제 AWS를 사용하는 사람 혹은 애플리케이션
 - 그룹
   - 사용자의 집합
   - 그룹에 속한 사용자는 그룹에 부여된 권한을 행사
 - 정책(Policy)
   - 사용자와 그룹, 역할이 무엇을 할 수 있는지에 관한 문서
   - JSON 형식으로 정의
 - 역할(Role)
   - AWS 리소스에 부여하여 AWS 리소스가 무엇을 할 수 있는지를 정의
   - 혹은 다른 사용자가 역할을 부여받아 사용
   - 다른 자격에 대해서 신뢰 관계를 구축 가능
   - 역할을 바꾸어가며 서비스를 사용 가능

<br/>

### IAM의 권한 검증

첫 번째로 사용자에게 이용할 수 있는 정책이 부여되었는지 확인한다.  
두 번째로 그룹에 이용할 수 있는 정책이 부여되었는지 확인한다.  
세 번째로 사용자에게 위임된 역할에 이용할 수 있는 정책이 부여되었는지 확인한다.  
모두 없으면 권한이 없는 것으로 간주한다.  

<br/>

## IAM 모범 사용 사례

 - 루트 사용자는 사용하지 않기
 - 불필요한 사용자는 만들지 않기
 - 가능하면 그룹과 정책을 사용하기
 - 최소한의 권한만을 허용하는 습관을 들이기(Principle of least privilege)
 - MFA를 활성화 하기
 - AccessKey 대신 역할을 활용하기
 - IAM 자격 증명 보고서 활용하기
