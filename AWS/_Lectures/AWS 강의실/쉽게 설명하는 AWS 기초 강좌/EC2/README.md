# EC2

Amazone Elastic Compute Cloud(EC2)는 안전하고 크기 조정이 가능한 컴퓨팅 파워를 클라우드에서 제공하는 웹 서비스이다. 개발자가 더 쉽게 웹 규모의 클라우드 컴퓨팅 작업을 할 수 있도록 설계되었으며, Amazon EC2의 간단한 웹 서비스 인터페이스를 통해 간편하게 필요한 용량을 얻고 구성할 수 있다.  

 - 초 단위 온디맨드 가격 모델
 - 빠른 구축 속도와 확장성
 - 다양한 구성 방법 지원
    - 머신 러닝, 웹 서버, 게임 서버, 이미지 처리 등 다양한 용도에 최적화된 서버 구성 가능
    - 다양한 과금 모델 사용 가능
 - 여러 AWS 서비스와 연동
    - 오토 스케일링, Elastic Load Balancer(ELB), CloudWatch

<br/>

### EC2의 구성

 - 인스턴스
    - 클라우드에서 사용하는 가상 서버로 CPU, 메모리, 그래픽카드 등 연산을 위한 하드웨어를 담당
 - EBS
    - Elastic Block Storage의 줄임말로 클라우드에서 사용하는 가상 하드디스크
 - AMI
    - EC2 인스턴스를 실행하기 위한 정보를 담고 있는 이미지
 - 보안 그룹
    - 가상의 방화벽

<br/>

### EC2 가격 정책

 - On-Demand
    - 실행하는 인스턴스에 따라 시간 또는 초당 컴퓨팅 파워로 측정된 가격을 지불
    - 약정은 필요 없음
    - 장기적인 수요 예측이 힘들거나 유연하게 EC2를 사용하고 싶을 때 사용
 - Spot Instance
    - 경매 형식으로 시장에 남는 인스턴스를 저렴하게 구매해서 쓰는 방식
    - 최대 90% 정도 저렴하게 사용 가능
    - 단 언제 도로 내주어야 할지 모름
    - 시작 종료가 자유롭거나 추가적인 컴퓨팅 파워가 필요한 경우
    - __수요에 따라 스팟 인스턴스의 가격은 계속 변동하며, 내가 지정한 가격보다 현재 가격이 낮다면 사용하고 가격이 높다면 반환된다.__
    - __반환 시간이 예측 불가능하기 떄문에, 인스턴스가 확보되고 종료되는 것을 반복해도 문제 없는 분산 아키텍처가 필요하다.__
 - 예약 인스턴스(Reserved Instance-RI)
    - 미리 일정 기간(1~3년) 약정해서 쓰는 방식
    - 최대 75% 정도 저렴하게 사용 가능
    - 수요 예측이 확실할 때
    - 총 비용을 절감하기 위해 어느정도 기간의 약정이 가능한 사용자
 - 전용 호스트(Dedicated)
    - 실제 물리적인 서버를 임대하는 방식
    - 라이선스 이슈(Windows Server 등)
    - 규정에 따라 필요한 경우
    - 퍼포먼스 이슈(CPU Steal)
 - 기타 내용
    - 가격 순서: 스팟 인스턴스 < 예약 인스턴스 < 온디맨드 < 전용 호스트
    - 기타 데이터 통신 등의 비용은 별도로 청구
    - 참고로 AWS는 AWS 바깥으로 나가는 트래픽에 대해서만 요금을 부과 (업로드는 비용 X, 다운로드는 비용 O)

<br/>

### EC2 유형과 크기

 - 인스턴스 별로 사용 목적에 따라 최적화
    - 메모리 위주, CPU 위주, 그래픽 성능 위주 등
 - 타입별로 이름 부여
    - ex) t타입, m타입, inf타입 등
 - 타입 별 세대별로 숫자 부여
    - ex) m5 = m 인스턴스의 5번째 세대
 - 아키텍처 및 사용 기술에 따라 접두사
    - ex) t4g = t4 인스턴스 중 AWS Graviton 프로세서 사용
 - `인스턴스 유형 종류`
    - 범용
        - t: 저렴한 범용 (웹서버, DB)
        - m: 범용 (애플리케이션 서버)
        - A1: ARM 기반(ARM 기반 에코시스템 워크로드, 웹서버)
        - Mac: 맥 기반
    - 컴퓨팅 최적화
        - c: 컴퓨팅 최적화 (CPU 성능이 중요한 애플리케이션, DB)
        - f: 하드웨어 가속(유전 연구, 금융 분석, 빅데이터 분석)
        - Inf: 머신 러닝용 (머신러닝)
        - g: 그래픽 최적화 (3D 모델링, 인코딩)
     - 메모리 최적화
        - r: 메모리 최적화 (메모리 성능이 중요한 애플리케이션, DB)
        - x: 메모리 최적화 (Spark)
        - p: 그래픽 최적화 (머신러닝, 비트코인)
        - z: 고주파 컴퓨팅 워크로드 (EDA애플리케이션)
        - u-6tb1: 대용량 메모리 인스턴스 (가상화 오버헤드를 줄여주는 베어메탈)
     - 저장 최적화
        - h: 디스크쓰루풋 최적화 (하둡, 맵리듀스)
        - i: 디스크 속도 최적화 (NoSQL, 데이터 웨어 하우스)
        - d: 디스크 최적화 (파일 서버, 데이터 웨어 하우스, 하둡)
 - `인스턴스 타입 읽기`
    - [인스턴스 타입][세대][접두사].[사이즈]
    - ex) m5a.xlarge: m 유형의 5번째세대 AMD 기반 CPU를 사용한 인스턴스로 사이즈는 xlarge 이다.

<br/>

### EC2 생명주기

 - 중지
   - 중지 중에는 인스턴스 요금 미청구
   - 단, EBS 요금, 다른 구성요소(Elastic IP 등)은 청구
   - 중지 후 재시작시 퍼블릭 IP 변경
   - EBS를 사용하는 인스턴스만 중지 가능, 인스턴스 저장 인스턴스는 중지 불가
 - 재부팅
   - 재부팅시에는 퍼블릭 IP 변동 없음
 - 최대 절전 모드
   - 메모리 내용을 보존해서 재시작시 중단지점에서 시작할 수 있는 정지모드

<br/>

### EC2 실습

```
1. EC2를 구성하기 위한 AMI 선택
 - Amazone Linux 2 AMI (HVM)

2. EC2의 유형과 사이즈 선택
 - t2.micro

3. EBS 설정
 - 범용 SSD(gp2) 8GB

4. 태그 추가
 - 키: Name
 - 값: MyWebserver

5. 보안 그룹 설정
 - 규칙: HTTP 80 PORT

6. EC2 생성

7. EC2 접속 후 웹 서버 설치 및 웹 서버 실행
 - $ sudo -s
 - $ yum install httpd -y
 - $ service httpd start

8. 웹 브라우저에서 접속 테스트

```
