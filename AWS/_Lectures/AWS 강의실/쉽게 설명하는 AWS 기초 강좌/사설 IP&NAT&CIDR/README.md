# 사설 IP, NAT, CIDR

## 사설 IP(Private IP)

 - 한정된 IP 주소를 최대한 활용하기 위해 IP 주소를 분할하고자 만든 개념
    - IPv4 기준으로 최대 IP 개수는 43억개(4,294,967,296)
 - 사설망
    - 사설망 내부에는 외부 인터넷 망으로 통신이 불가능한 사설 IP로 구성
    - 외부로 통신할 때는 통신 가능한 공인 IP로 나누어 사용
    - 보통 하나의 망에는 사설 IP를 부여받은 기계들과 NAT 기능을 갖춘 Gateway로 구성

<br/>

## NAT(Network Address Translation)

 - 사설 IP가 공용 IP로 통신할 수 있도록 주소를 변환해 주는 방법
 - 3 가지 종류
    - Dynamic NAT
        - 1개의 사설 IP를 가용 가능한 공인 IP로 연결
        - 공인 IP 그룹(NAT Pool)에서 현재 사용 가능한 IP를 가져와서 연결
        - Private IP, 공인 IP, Dest IP 가 전송된다.
    - Static NAT
        - 하나의 사설 IP를 고정된 하나의 공인 IP로 연결
        - 사설 IP 숫자만큼 공인 IP가 필요하다.
        - AWS Internet Gateway가 사용하는 방식
        - Private IP, 공인 IP, Dest IP 가 전송된다.
    - PAT(Port Address Translation)
        - 많은 사설 IP를 하나의 공인 IP로 연결
        - 대부분의 사설 네트워크(회사, 집)가 사용
        - NAT Gateway/NAT Instance가 사용하는 방식
        - Private IP, Port, SRC Port, 공인 IP, Dest IP 가 전송된다.
            - 사설 IP 192.168.0.2가 Dest IP로 통신하려고 한다.
            - 그럼, 중간에 있는 Gateway(NAT)가 트래픽을 받아서 처리를 한다.
            - 해당 사설 IP에 요청에 대해서 SRC Port를 지정해서 요청하고, 서버의 응답으로 SRC Port 정보를 받아서 해당 사설 IP로 다시 전달해준다.

<br/>

## 사설 IPs

 - A 클래스
    - 이름: 24-bit block
    - IP 주소 범위: 10.0.0.0 ~ 10.255.255.255
    - IP 개수: 16,777,216
    - 서브넷 마스크: 255.0.0.0
 - B 클래스
    - 이름: 20-bit block
    - IP 주소 범위: 172.16.0.0 ~ 172.31.255.255
    - IP 개수: 104,857
    - 서브넷 마스크: 255.240.0.0
 - C 클래스
    - 이름: 16-bit block
    - IP 주소 범위: 192.168.0.0 ~ 192.168.255.255
    - IP 개수: 65,536
    - 서브넷 마스크: 255.255.0.0

<br/>

## Classless Inter Domain Routing (CIDR)

 - Classless Inter Domain Routing
    - IP는 주소의 영역을 여러 네트워크 영역으로 나누기 위해 IP를 묶는 방식
    - 여러 개의 사설망을 구축하기 위해 망을 나누는 방법
 - CIDR Block/CIDR Notation
    - CIDR Block: IP 주소의 집합
    - CIDR Notation: CIDR Block을 표시하는 방법
        - 네트워크 주소와 호스트 주소로 구성
        - 각 호스트 주소 숫자만큼의 IP를 가진 네트워크 망 형성 가능
    - A.B.C.D/E 형식
        - A,B,C,D: 네트워크 주소 + 호스트 주소 표시
        - E: 0 ~ 32 숫자로 네트워크 주소가 몇 bit 인지 표시
        - ex): 10.0.1.0/24, 172.16.0.0/12
            - 네트워크 주소는 고정된 부분
            - 호스트 주소는 변동되는 부분
            - 192.168.2.0/24
                - 24비트가 네트워크 주소 = 192.168.2 까지 네트워크 주소 (24비트)
                - 0은 호스트 주소 = 0 ~ 255로 256개의 주소 (8 Bit)
                - 192.168.2.0 ~ 192.168.2.255로 표현이 가능하다.

<br/>

## 서브넷

 - 네트워크 안의 네트워크
 - 큰 네트워크를 잘게 쪼갠 단위
 - 일정 IP 주소의 범위를 보유
    - 큰 네트워크에 부여된 IP 범위를 조금씩 잘라 작은 단위로 나눈 후 각 서브넷에 할당

```
192.168.0.0/16 네트워크 주소가 있다.
네트워크 주소가 16비트이고, 호스트 주소가 16비트다.
해당 네트워크 주소는 2의 16제곱 만큼의 IP 주소를 보유하고 있는 큰 네트워크이다.

이것을 각각의 서브넷으로 쪼갠다.
각각의 서브 네트워크안에서는 24 Bit까지 고정시키고, 나머지 변동할 수 있는 8 Bit만으로 IP를 구성한다.
 - 서브넷1: 192.168.1.0/24
    - Gateway: 192.168.1.1
    - 192.168.1.2
    - 192.168.1.3
    - ..
 - 서브넷2: 192.168.2.0/24
    - Gateway: 192.168.2.1
    - 192.168.2.2
    - 192.168.2.3
    - ..

```
